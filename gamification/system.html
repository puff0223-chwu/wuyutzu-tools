<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·«é­šå­å¤§å¸«éŠæˆ²åŒ–ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: linear-gradient(135deg, #c41e3a 0%, #8b0000 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1em;
        }

        .tabs {
            display: flex;
            background: #f0f0f0;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            flex: 1;
            padding: 18px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            transition: all 0.3s;
            border: none;
            background: none;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: white;
            color: #c41e3a;
            border-bottom: 3px solid #c41e3a;
        }

        .content {
            padding: 30px;
            min-height: 400px;
        }

        .system {
            display: none;
        }

        .system.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            color: #555;
            margin-bottom: 6px;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .probability-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .probability-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .probability-item label {
            display: block;
            font-size: 0.95em;
            color: #666;
            margin-bottom: 5px;
        }

        .probability-item input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .status-bar {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .status-bar.error {
            border-left-color: #dc2626;
            background: #fee;
        }

        .status-bar.success {
            border-left-color: #16a34a;
            background: #efe;
        }

        .btn {
            background: linear-gradient(135deg, #c41e3a 0%, #8b0000 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(196, 30, 58, 0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .result-box {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            display: none;
            animation: scaleIn 0.5s ease-out;
        }

        .result-box.show {
            display: block;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .result-box h2 {
            color: #c41e3a;
            font-size: 2em;
            margin-bottom: 15px;
        }

        .result-text {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
            margin: 15px 0;
        }

        .method-tag {
            background: rgba(255,255,255,0.7);
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
            font-size: 0.9em;
            color: #666;
        }

        .history {
            background: white;
            padding: 15px;
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        .history h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .history-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item .time {
            font-size: 0.85em;
            color: #999;
        }

        .curse-box {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            display: none;
            animation: shake 0.5s ease-out;
        }

        .curse-box.show {
            display: block;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .curse-box h2 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .curse-text {
            font-size: 1.5em;
            font-weight: bold;
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }

        footer {
            text-align: center;
            padding: 20px;
            border-top: 2px solid #f0f0f0;
            color: #999;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .container {
                margin: 0;
                border-radius: 0;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .probability-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="../index.html" style="position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: white; text-decoration: none; font-size: 1.5em; transition: opacity 0.3s;" onmouseover="this.style.opacity='0.7'" onmouseout="this.style.opacity='1'">
                â† è¿”å›é¦–é 
            </a>
            <h1>ğŸ§™ å·«é­šå­å¤§å¸«éŠæˆ²åŒ–ç³»çµ±</h1>
            <p>è®“èª²å ‚äº’å‹•æ›´æœ‰è¶£çš„éŠæˆ²åŒ–å·¥å…·é›†</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchSystem('selector')">ğŸ¯ é¸äººç³»çµ±</button>
            <button class="tab" onclick="switchSystem('curse')">ğŸ’€ é™£äº¡è©›å’’ç³»çµ±</button>
        </div>

        <div class="content">
            <!-- é¸äººç³»çµ± -->
            <div id="system-selector" class="system active">
                <div class="section">
                    <h3>âš™ï¸ åŸºæœ¬è¨­å®š</h3>
                    <div class="form-group">
                        <label>ç­ç´šäººæ•¸ (1-50äºº)</label>
                        <input type="number" id="studentCount" value="30" min="1" max="50" onchange="updateProbabilityStatus()">
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ² æ©Ÿç‡è¨­å®š</h3>
                    <div class="probability-grid">
                        <div class="probability-item">
                            <label>æŠ½å…¨ç­</label>
                            <input type="number" class="prob-input" data-method="all" value="1" min="0" max="100" onchange="updateProbabilityStatus()">
                            <small>%</small>
                        </div>
                        <div class="probability-item">
                            <label>æŠ½å¥³ç”Ÿ</label>
                            <input type="number" class="prob-input" data-method="girls" value="3" min="0" max="100" onchange="updateProbabilityStatus()">
                            <small>%</small>
                        </div>
                        <div class="probability-item">
                            <label>æŠ½ç”·ç”Ÿ</label>
                            <input type="number" class="prob-input" data-method="boys" value="3" min="0" max="100" onchange="updateProbabilityStatus()">
                            <small>%</small>
                        </div>
                        <div class="probability-item">
                            <label>æŠ½1å</label>
                            <input type="number" class="prob-input" data-method="one" value="50" min="0" max="100" onchange="updateProbabilityStatus()">
                            <small>%</small>
                        </div>
                        <div class="probability-item">
                            <label>æŠ½2å</label>
                            <input type="number" class="prob-input" data-method="two" value="25" min="0" max="100" onchange="updateProbabilityStatus()">
                            <small>%</small>
                        </div>
                        <div class="probability-item">
                            <label>æŠ½3å</label>
                            <input type="number" class="prob-input" data-method="three" value="12" min="0" max="100" onchange="updateProbabilityStatus()">
                            <small>%</small>
                        </div>
                        <div class="probability-item">
                            <label>å¥‡æ•¸åº§è™Ÿ</label>
                            <input type="number" class="prob-input" data-method="odd" value="3" min="0" max="100" onchange="updateProbabilityStatus()">
                            <small>%</small>
                        </div>
                        <div class="probability-item">
                            <label>å¶æ•¸åº§è™Ÿ</label>
                            <input type="number" class="prob-input" data-method="even" value="3" min="0" max="100" onchange="updateProbabilityStatus()">
                            <small>%</small>
                        </div>
                    </div>

                    <div id="probabilityStatus" class="status-bar success">
                        âœ… æ©Ÿç‡ç¸½å’Œ: <strong id="totalProb">100</strong>% - è¨­å®šæ­£å¸¸ï¼Œå¯ä»¥é€²è¡ŒæŠ½ç±¤
                    </div>
                </div>

                <button class="btn" id="drawBtn" onclick="drawStudents()">ğŸ² é–‹å§‹ç¥ç§˜æŠ½ç±¤</button>

                <div id="resultBox" class="result-box">
                    <h2>ğŸ¯ æŠ½ç±¤çµæœ</h2>
                    <div class="method-tag" id="methodTag"></div>
                    <div class="result-text" id="resultText"></div>
                </div>

                <div class="section">
                    <div class="history">
                        <h4>ğŸ“œ æŠ½ç±¤æ­·å² (æœ€è¿‘10æ¬¡)</h4>
                        <div id="historyList"></div>
                    </div>
                </div>
            </div>

            <!-- é™£äº¡è©›å’’ç³»çµ± -->
            <div id="system-curse" class="system">
                <div class="section">
                    <h3>ğŸ’€ é™£äº¡è©›å’’ç³»çµ±</h3>
                    <p style="color: #666; line-height: 1.8; margin-bottom: 20px;">
                        ç•¶è‹±é›„è§’è‰²è¡€é‡é™ç‚º0æ™‚ï¼Œå°‡éš¨æ©ŸæŠ½å–ä¸€å€‹è©›å’’ä½œç‚ºæ‡²ç½°ã€‚æ¯ç¨®è©›å’’çš„æŠ½ä¸­æ©Ÿç‡ç›¸åŒï¼Œä¹Ÿæœ‰æ©Ÿæœƒå¹¸é‹å¾©æ´»ï¼
                    </p>

                    <div style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: #333; margin-bottom: 12px; font-size: 1.1em;">ğŸ“œ è©›å’’æ¸…å–® (ç­‰æ©Ÿç‡æŠ½å–)</h4>
                        <ol style="padding-left: 20px; color: #555; line-height: 2;">
                            <li>æ“”ä»»å¤§å¸«çš„å°å¿—å·¥ä¸€æ¬¡</li>
                            <li>ä¸€æ—¥ç„¡æ‰‹æ©Ÿé«”é©—(ä¸Šå­¸ä¸Šç¹³ï¼Œæ”¾å­¸é ˜)</li>
                            <li>-500 XP</li>
                            <li>ä¸­åˆåˆ°è¾¦å…¬å®¤é»˜å¯«å¤§å¸«è¦å®šçš„å…ƒç´ é€±æœŸè¡¨ï¼Œç›´åˆ°éé—œç„¡æ­¢</li>
                            <li>æ‰“æƒåŒ–å­¸å¯¦é©—å®¤ä¸€æ¬¡</li>
                            <li>åœ¨æ•™å®¤æˆ´è‘—å·¥åœ°å¸½ä¸Šèª²ä¸€ç¯€</li>
                            <li>ç©¿è‘—å¥åº·é‹èµ°æ•™å®¤ä¸€åœˆ</li>
                            <li>ç©ä¸€æ¬¡çœŸå¿ƒè©±å¤§å†’éšª</li>
                            <li style="color: #16a34a; font-weight: bold;">ğŸ€ å…è²»å¾©æ´»ï¼Œå¥‡è¹Ÿå¼åœ°æ²’æœ‰è¢«è©›å’’</li>
                        </ol>
                    </div>
                </div>

                <button class="btn btn-secondary" onclick="drawCurse()">â˜ ï¸ è‹±é›„é™£äº¡ï¼ŒæŠ½å–è©›å’’</button>

                <div id="curseBox" class="curse-box">
                    <h2>âš¡ è©›å’’é™è‡¨</h2>
                    <div>ä½ æŠ½åˆ°çš„è©›å’’æ˜¯ï¼š</div>
                    <div class="curse-text" id="curseText"></div>
                </div>

                <div class="section">
                    <div class="history">
                        <h4>ğŸ’€ é™£äº¡è¨˜éŒ„</h4>
                        <div id="curseHistory"></div>
                        <button class="btn" onclick="clearCurseHistory()" style="margin-top: 15px; font-size: 0.9em; padding: 10px;">
                            æ¸…é™¤è¨˜éŒ„
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            ç¨‹å¼è¨­è¨ˆ:å·«é­šå­ <sup>Â©</sup> 2025
        </footer>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let students = [];
        let drawHistory = [];
        let curseHistory = [];

        // è©›å’’åˆ—è¡¨
        const curses = [
            'æ“”ä»»å¤§å¸«çš„å°å¿—å·¥ä¸€æ¬¡',
            'ä¸€æ—¥ç„¡æ‰‹æ©Ÿé«”é©—(ä¸Šå­¸ä¸Šç¹³ï¼Œæ”¾å­¸é ˜)',
            '-500 XP',
            'ä¸­åˆåˆ°è¾¦å…¬å®¤é»˜å¯«å¤§å¸«è¦å®šçš„å…ƒç´ é€±æœŸè¡¨ï¼Œç›´åˆ°éé—œç„¡æ­¢',
            'æ‰“æƒåŒ–å­¸å¯¦é©—å®¤ä¸€æ¬¡',
            'åœ¨æ•™å®¤æˆ´è‘—å·¥åœ°å¸½ä¸Šèª²ä¸€ç¯€',
            'ç©¿è‘—å¥åº·é‹èµ°æ•™å®¤ä¸€åœˆ',
            'ç©ä¸€æ¬¡çœŸå¿ƒè©±å¤§å†’éšª',
            'å…è²»å¾©æ´»ï¼Œå¥‡è¹Ÿå¼åœ°æ²’æœ‰è¢«è©›å’’'
        ];

        // åˆ‡æ›ç³»çµ±
        function switchSystem(systemId) {
            // æ›´æ–°æ¨™ç±¤
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // æ›´æ–°å…§å®¹
            document.querySelectorAll('.system').forEach(sys => sys.classList.remove('active'));
            document.getElementById('system-' + systemId).classList.add('active');
        }

        // åˆå§‹åŒ–å­¸ç”Ÿè³‡æ–™
        function initStudents() {
            const count = parseInt(document.getElementById('studentCount').value);
            students = [];
            
            for (let i = 1; i <= count; i++) {
                students.push({
                    number: i,
                    gender: i % 2 === 0 ? 'female' : 'male' // ç°¡å–®åˆ†é…æ€§åˆ¥
                });
            }
        }

        // æ›´æ–°æ©Ÿç‡ç‹€æ…‹
        function updateProbabilityStatus() {
            const inputs = document.querySelectorAll('.prob-input');
            let total = 0;
            
            inputs.forEach(input => {
                total += parseFloat(input.value) || 0;
            });

            const statusBar = document.getElementById('probabilityStatus');
            const totalProb = document.getElementById('totalProb');
            const drawBtn = document.getElementById('drawBtn');

            totalProb.textContent = total.toFixed(1);

            if (total > 100) {
                statusBar.className = 'status-bar error';
                statusBar.innerHTML = `âŒ æ©Ÿç‡ç¸½å’Œ: <strong>${total.toFixed(1)}</strong>% - æ©Ÿç‡ç¸½å’Œè¶…é100%ï¼Œç„¡æ³•é€²è¡ŒæŠ½ç±¤`;
                drawBtn.disabled = true;
            } else if (total === 0) {
                statusBar.className = 'status-bar error';
                statusBar.innerHTML = `âš ï¸ æ©Ÿç‡ç¸½å’Œ: <strong>0</strong>% - è«‹è¨­å®šè‡³å°‘ä¸€å€‹æŠ½ç±¤æ–¹å¼çš„æ©Ÿç‡`;
                drawBtn.disabled = true;
            } else {
                statusBar.className = 'status-bar success';
                statusBar.innerHTML = `âœ… æ©Ÿç‡ç¸½å’Œ: <strong>${total.toFixed(1)}</strong>% - è¨­å®šæ­£å¸¸ï¼Œå¯ä»¥é€²è¡ŒæŠ½ç±¤`;
                drawBtn.disabled = false;
            }
        }

        // æ ¹æ“šæ©Ÿç‡é¸æ“‡æŠ½ç±¤æ–¹å¼
        function selectMethod() {
            const methods = [];
            document.querySelectorAll('.prob-input').forEach(input => {
                const prob = parseFloat(input.value) || 0;
                const method = input.dataset.method;
                if (prob > 0) {
                    methods.push({ method, prob });
                }
            });

            const totalProb = methods.reduce((sum, m) => sum + m.prob, 0);
            const random = Math.random() * totalProb;
            
            let cumulative = 0;
            for (let m of methods) {
                cumulative += m.prob;
                if (random <= cumulative) {
                    return m.method;
                }
            }
            
            return methods[0].method;
        }

        // åŸ·è¡ŒæŠ½ç±¤
        function drawStudents() {
            initStudents();
            const method = selectMethod();
            let result = [];
            let methodName = '';

            switch(method) {
                case 'all':
                    result = ['å…¨ç­åŒå­¸'];
                    methodName = 'æŠ½å…¨ç­';
                    break;
                case 'girls':
                    result = ['å¥³ç”ŸåŒå­¸'];
                    methodName = 'æŠ½å¥³ç”Ÿ';
                    break;
                case 'boys':
                    result = ['ç”·ç”ŸåŒå­¸'];
                    methodName = 'æŠ½ç”·ç”Ÿ';
                    break;
                case 'odd':
                    result = ['å¥‡æ•¸è™ŸåŒå­¸'];
                    methodName = 'å¥‡æ•¸åº§è™Ÿ';
                    break;
                case 'even':
                    result = ['å¶æ•¸è™ŸåŒå­¸'];
                    methodName = 'å¶æ•¸åº§è™Ÿ';
                    break;
                case 'one':
                    result = [getRandomStudent(1)];
                    methodName = 'æŠ½1å';
                    break;
                case 'two':
                    result = getRandomStudent(2);
                    methodName = 'æŠ½2å';
                    break;
                case 'three':
                    result = getRandomStudent(3);
                    methodName = 'æŠ½3å';
                    break;
            }

            displayResult(result, methodName);
            addToHistory(result, methodName);
        }

        // éš¨æ©ŸæŠ½å–å­¸ç”Ÿ
        function getRandomStudent(count) {
            const shuffled = [...students].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count).map(s => `${s.number}è™Ÿ`);
        }

        // é¡¯ç¤ºçµæœ
        function displayResult(result, method) {
            const resultBox = document.getElementById('resultBox');
            const methodTag = document.getElementById('methodTag');
            const resultText = document.getElementById('resultText');

            methodTag.textContent = method;
            resultText.textContent = Array.isArray(result) ? result.join('ã€') : result;
            
            resultBox.classList.remove('show');
            setTimeout(() => resultBox.classList.add('show'), 100);
        }

        // æ·»åŠ åˆ°æ­·å²
        function addToHistory(result, method) {
            const time = new Date().toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
            drawHistory.unshift({ result: Array.isArray(result) ? result.join('ã€') : result, method, time });
            
            if (drawHistory.length > 10) {
                drawHistory = drawHistory.slice(0, 10);
            }

            updateHistoryDisplay();
        }

        // æ›´æ–°æ­·å²é¡¯ç¤º
        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            
            if (drawHistory.length === 0) {
                historyList.innerHTML = '<div style="color: #999; text-align: center; padding: 20px;">å°šç„¡æŠ½ç±¤è¨˜éŒ„</div>';
                return;
            }

            historyList.innerHTML = drawHistory.map(item => `
                <div class="history-item">
                    <div>
                        <strong>${item.method}</strong>: ${item.result}
                    </div>
                    <div class="time">${item.time}</div>
                </div>
            `).join('');
        }

        // æŠ½å–è©›å’’
        function drawCurse() {
            const randomIndex = Math.floor(Math.random() * curses.length);
            const curse = curses[randomIndex];

            const curseBox = document.getElementById('curseBox');
            const curseText = document.getElementById('curseText');

            curseText.textContent = curse;
            curseBox.classList.remove('show');
            setTimeout(() => curseBox.classList.add('show'), 100);

            addToCurseHistory(curse);
        }

        // æ·»åŠ åˆ°è©›å’’æ­·å²
        function addToCurseHistory(curse) {
            const time = new Date().toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
            curseHistory.unshift({ curse, time });
            updateCurseHistoryDisplay();
        }

        // æ›´æ–°è©›å’’æ­·å²é¡¯ç¤º
        function updateCurseHistoryDisplay() {
            const curseHistoryList = document.getElementById('curseHistory');
            
            if (curseHistory.length === 0) {
                curseHistoryList.innerHTML = '<div style="color: #999; text-align: center; padding: 20px;">å°šç„¡é™£äº¡è¨˜éŒ„</div>';
                return;
            }

            curseHistoryList.innerHTML = curseHistory.map(item => `
                <div class="history-item">
                    <div>${item.curse}</div>
                    <div class="time">${item.time}</div>
                </div>
            `).join('');
        }

        // æ¸…é™¤è©›å’’æ­·å²
        function clearCurseHistory() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰é™£äº¡è¨˜éŒ„å—ï¼Ÿ')) {
                curseHistory = [];
                updateCurseHistoryDisplay();
            }
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', () => {
            updateProbabilityStatus();
            updateHistoryDisplay();
            updateCurseHistoryDisplay();
        });
    </script>
</body>
</html>